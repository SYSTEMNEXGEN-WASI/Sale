
@{
    ViewBag.Title = "VehicleReturnMain";
    Layout = "~/Views/Shared/_LayoutV2.cshtml";
}


<style>
    .makespace {
        margin-bottom: 20px;
    }

    .icheckbox_minimal-blue {
        top: 10px;
    }

    .mandatory {
        color: red;
    }
</style>

<link href="../assets/plugins/icheck/skins/all.css" rel="stylesheet" type="text/css" media="screen" />
<link href="../assets/plugins/icheck/skins/all.css" rel="stylesheet" type="text/css" media="screen" />
<script src="../assets/plugins/icheck/icheck.min.js" type="text/javascript"></script>
<link href='@Url.Content("~/assets/css/style.css")' rel="stylesheet" type="text/css" />
<link href='@Url.Content("~/assets/css/responsive.css")' rel="stylesheet" type="text/css" />

<section class="wrapper main-wrapper row" style=''>

    <div class="clearfix"></div>

    @* Main Body Starts *@
    <form method="post">
        <div class="col-xs-12">
            <section class="box">
                <header class="panel_header">
                    <h2 class="title pull-left">Vehicle Return</h2>
                    <div class="actions panel_actions pull-right">
                        <a class="box_toggle fa fa-chevron-down"></a>
                        @*<a class="box_setting fa fa-cog" data-toggle="modal" href="#section-settings"></a>*@
                    </div>
                </header>
                <div class="content-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label">Return Code</label>
                            <div class="input-group">
                                @*<span class="input-group-addon"><i class="fa fa-info"></i></span>*@
                                <span class="input-group-addon"><a id="IssueClick" data-toggle="modal" data-target="#VehRetModal" style="color:blue"><i class="fa fa-search"></i></a></span>
                                <input type="text" class="form-control" id="txtRetCode" readonly>                            
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Return Date</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input type="text" class="form-control" id="txtRetDate" readonly>
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Return Type</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-file"></i></span>
                                <select class="form-control m-bot15" id="ddlReturnType" onchange="ChangeColor(this)">
                                    <option value="0">Select</option>
                                    <option value="OEM">OEM </option>
                                    <option value="Dealer">Dealer</option>
                                </select>
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Dealer/Supplier</label>
                            <div class="input-group">
                                <span class="input-group-addon"><a id="IssueClick" data-toggle="modal" data-target="#DealerSupplierModal" style="color:blue"><i class="fa fa-search"></i></a></span>
                                <input type="text" class="form-control" id="txtDealSupp" onblur="ChangeColor(this)" readonly>
                            </div>
                            <div class="makespace"></div>
                        </div>
                        

                        <div class="col-md-4">
                            <label class="form-label">Document No</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-info"></i></span>
                                <input type="text" class="form-control" id="txtDocNo" maxlength="20">
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Remarks</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-info"></i></span>
                                <input type="text" class="form-control" id="txtRemarks" maxlength="100">
                            </div>
                            <div class="makespace"></div>
                        </div>
                    </div>

                    <hr style="border-top:1px solid blue;" />

                    <div class="row">

                        <div class="col-md-4">
                            <label class="form-label">VIN / Chassis</label>
                            <div class="input-group">
                                <span class="input-group-addon"><a id="IssueClick" data-toggle="modal" data-target="#ChasisModal" style="color:blue"><i class="fa fa-search"></i></a></span>
                                <input type="text" class="form-control" id="txtChasisNo" readonly />
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Engine</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-car"></i></span>
                                <input type="text" class="form-control" id="txtEngineNo" readonly />
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Color</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-pie-chart"></i></span>
                                <input type="text" class="form-control" id="txtColor" readonly />   
                                <input type="hidden" id="hdnColorCode" />                                
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Brand</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-car"></i></span>
                                <input type="text" class="form-control" id="txtBrand" readonly /> 
                                <input type="hidden" id="hdnBrandCode"/>                            
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Product</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-car"></i></span>
                                <input type="text" class="form-control" id="txtProduct" readonly />
                                <input type="hidden" id="hdnProdCode" />   
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Version</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-car"></i></span>
                                <input type="text" class="form-control" id="txtVersion" readonly />
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Customer</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-car"></i></span>
                                <input type="text" class="form-control" id="txtCustomer" readonly />
                                <input type="hidden" id="hdnCusCode" />   
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Booking No</label>
                            <div class="input-group">
                                <span class="input-group-addon">
                                    <span class="arrow"></span>
                                    <i class="fa fa-file"></i>
                                </span>
                                <input type="text" required class="form-control" id="txtBookingNo" readonly />
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Book Ref No</label>
                            <div class="input-group">
                                <span class="input-group-addon">
                                    <span class="arrow"></span>
                                    <i class="fa fa-file"></i>
                                </span>
                                <input type="text" required class="form-control" id="txtBookRefNo" readonly />
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Book Ref Date</label>
                            <div class="input-group">
                                <span class="input-group-addon">
                                    <span class="arrow"></span>
                                    <i class="fa fa-file"></i>
                                </span>
                                <input type="text" required class="form-control" id="txtBookRefDate" readonly />
                            </div>
                            <div class="makespace"></div>
                        </div>                      

                        <div class="col-md-4 pull-right">
                            <div class="input-group" style="width:100%;">
                                <button class="btn btn-success btn-sm" type="button" style="width: 100%;padding: 8px; margin-top: 20px; right: 15px;" onclick="AddProduct(this)">
                                    <i class="fa fa-plus fa-2x"></i>
                                </button>
                            </div>
                            <div class="makespace"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="table-responsive">
                                <table class="table table-bordered table-striped" id="productDetail" style="white-space: nowrap; FONT-SIZE: 13px;">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Brand </th>
                                            <th>Product</th>
                                            <th>Version</th>
                                            <th>Color</th>
                                            <th>Chassis No</th>
                                            <th>Engine No</th>
                                            <th>Customer</th>
                                            <th>Booking No</th>
                                            <th>Book Ref No</th>
                                            <th>Book Ref Date</th>                                            
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                       
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-6">
                            <label id="lblMsg" style="margin-top: 30px;"></label>
                        </div>
                        <div class="col-xs-6">
                            <div class="pull-right">
                                <button type="button" class="btn btn-default" id="btnCancel" style="margin-top:25px; border-radius:0px;">Cancel</button>
                                <button type="button" class="btn btn-primary" id="btnSave" style="margin-top:25px; border-radius:0px;">Save</button>
                                <button type="button" class="btn btn-danger" id="btnDelete" style="margin-top:25px; border-radius:0px;" >Delete</button>
                                <a class="btn btn-primary" id="btnPrint" style="margin-top:25px; border-radius:0px;" href="#">Print</a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </form>
    <!-- Chasis No Modal Start -->
    <div class="modal" tabindex="-1" id="ChasisModal" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="margin-top:60px;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="modal123Label">Vehicle Stock</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group row">
                        <label for="exampleInputuname" class="col-md-2">Search :</label>
                        <div class="col-md-10">
                            <input type="text" id="ChasisSearch" class="form-control" aria-controls="tblVehicleStock" placeholder="Search . . . ">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="table-responsive" style="height:300px;">
                            <table id="tblVehicleStock" class="table table-striped table-hover responsive">
                                <thead>
                                    <tr>
                                        @*<th>Sr</th>*@
                                        <th>ChasisNo</th>
                                        <th>EngineNo</th>
                                        <th>Brand</th>
                                        <th>Product</th>
                                        <th>Customer</th>
                                    </tr>
                                </thead>
                                <tbody style="font-size:12px; text-transform: uppercase">
                                    @if (ViewBag.VehicleStock != null)
                                    {
                                        foreach (var item in ViewBag.VehicleStock)
                                        {
                                            <tr style="text-align: left" onclick="ChasisNo('@item.BrandCode','@item.BrandDesc','@item.ProdCode','@item.ProdDesc','@item.VersionCode','@item.ColorCode','@item.ColorDesc','@item.ChasisNo','@item.EngineNo','@item.CusCode','@item.CusDesc','@item.BookingRefNo','@item.BookingRefDate','@item.BookingNo')">
                                                <td class="tdDiv">
                                                    <a href="#" style="color:black">@item.ChasisNo</a>
                                                </td>
                                                <td class="tdDiv">
                                                    <a href="#" style="color:black">@item.EngineNo</a>
                                                </td>
                                                <td class="tdDiv">
                                                    <a href="#" style="color:black">@item.BrandDesc</a>
                                                </td>
                                                <td class="tdDiv">
                                                    <a href="#" style="color:black">@item.ProdDesc</a>
                                                </td>
                                                <td class="tdDiv">
                                                    <a href="#" style="color:black">@item.CusDesc</a>
                                                </td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" style="text-transform: uppercase;" class="btn btn-danger waves-effect text-left" data-dismiss="modal">Close</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- Chasis No Modal End -->
    <!-- Dealer / Supplier Modal Start -->
    <div class="modal" tabindex="-1" id="DealerSupplierModal" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="margin-top:60px;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="modal123Label">Dealer / Supplier</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group row">
                        <label for="exampleInputuname" class="col-md-2">Search :</label>
                        <div class="col-md-10">
                            <input type="text" id="VehRecSearch" class="form-control" aria-controls="tblDealerSupplier" placeholder="Search . . . ">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="table-responsive" style="height:300px;">
                            <table id="tblDealerSupplier" class="table table-striped table-hover responsive">
                                <thead>
                                    <tr>
                                        <th>Sr</th>
                                        <th>Code</th>
                                        <th>Description</th>
                                        <th>ContactPerson</th>
                                        <th>Phone</th>
                                    </tr>
                                </thead>
                                <tbody style="font-size:12px; text-transform: uppercase">
                                   
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" style="text-transform: uppercase;" class="btn btn-danger waves-effect text-left" data-dismiss="modal">Close</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- Dealer / Supplier Modal End -->
    <!-- Vehicle Receipt Modal Start -->
    <div class="modal" tabindex="-1" id="VehRetModal" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="margin-top:60px;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="modal123Label">Vehicle Returns</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group row">
                        <label for="exampleInputuname" class="col-md-2">Search :</label>
                        <div class="col-md-10">
                            <input type="text" id="VehRecSearch" class="form-control" aria-controls="VehRetTable" placeholder="Search . . . ">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="table-responsive" style="height:300px;">
                            <table id="VehRetTable" class="table table-striped table-hover responsive">
                                <thead>
                                    <tr>
                                        <th>Sr</th>
                                        <th>Vehicle Return Code</th>
                                        <th>Vehicle Return Date</th>
                                        <th>Vendor/Customer</th>
                                        <th>Return Type</th>
                                    </tr>
                                </thead>
                                <tbody style="font-size:12px; text-transform: uppercase">
                                    @{ int i = 1; }
                                    @if (ViewBag.VehicleReturn != null)
                                    {
                                        foreach (var item in ViewBag.VehicleReturn)
                                        {
                                            <tr style="text-align: left" onclick="VehicleReturn('@item.ReturnCode','@item.ReturnDate','@item.VendorCustomer','@item.ReturnType','@item.Remarks','@item.DocumentNo')">
                                                <td> @i</td> @{ i++; }
                                                <td class="tdDiv">
                                                    <a href="#" style="color:black">@item.ReturnCode</a>
                                                </td>
                                                <td class="tdDiv">
                                                    <a href="#" style="color:black">@item.ReturnDate</a>
                                                </td>
                                                <td class="tdDiv">
                                                    <a href="#" style="color:black">@item.VendorCustomer</a>
                                                </td>
                                                <td class="tdDiv">
                                                    <a href="#" style="color:black">@item.ReturnType</a>
                                                </td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" style="text-transform: uppercase;" class="btn btn-danger waves-effect text-left" data-dismiss="modal">Close</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- Vehicle Receipt Modal End -->
    <!-- Popup box modal start -->
    <div class="modal" id="section-confirm" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog animated bounceInDown">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Confirm</h4>
                </div>
                <div class="modal-body">

                    <h5>Are you sure want to save ?</h5>

                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
                    <button class="btn btn-success" type="button" onclick="SaveEnquiry()">Save</button>
                </div>
            </div>
        </div>
    </div>
    <!-- modal end -->
    <div class="modal" id="section-confirm-Delete" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog animated bounceInDown">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Confirm</h4>
                </div>
                <div class="modal-body">

                    <h5>Are you sure want to Delete ?</h5>

                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
                    <button class="btn btn-danger" type="button" onclick="DeleteEnquiry()">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Popup box modal start -->
    <div class="modal" id="section-message" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog animated bounceInDown">
            <div class="modal-content">
                <div class="modal-header" id="modalMessage">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Alert Message</h4>
                </div>
                <div class="modal-body">

                    <h5 id="lblMessage"></h5>

                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- modal end -->
</section>

<script src='@Url.Content("~/assets/js/jquery-1.11.2.min.js")' type="text/javascript"></script>

<script>

    var today = new Date();

    $(document).ready(function () {

        $(".datepicker").datepicker({
            dateFormat: "dd-mm-yy"
        });

        
        var dd = today.getDate();
        var mm = today.getMonth() + 1; //January is 0!
        var yyyy = today.getFullYear();

        if (dd < 10) {
            dd = '0' + dd
        }

        if (mm < 10) {
            mm = '0' + mm
        }

        today = dd + '-' + mm + '-' + yyyy;

        $("#txtRetDate").val(today);
    })

    var rowCount = 1;
    var dataCount = 1;
    var SNo = 1;

    function ChangeColor(value) {

        if ($(value).val() != '' || $(value).val() != '0')
            $(value).css("border-color", "#e1e1e1");
    }

    $("#ChasisSearch").on("keyup", function () {

        var val = $(this).val();
        var value = val.toUpperCase();

        $("#tblVehicleStock tbody tr").each(function () {
            debugger
            $row = $(this);
            var id = $(this).closest('tr').find('#lblDONo').text();
            var lblChasisNo = $(this).closest('tr').find('#lblChasisNo').text();
            var lblCusDesc = $(this).closest('tr').find('#lblCusDesc').text();

            if (id.indexOf(value) !== 0 && lblChasisNo.toUpperCase().indexOf(value) !== 0 && lblCusDesc.toUpperCase().indexOf(value) !== 0) {
                $row.hide();
            }
            else {
                $row.show();
            }

        });
    });

    ChasisNo = function (BrandCode,BrandDesc,ProdCode,ProdDesc,Version,ColorCode,ColorDesc,ChasisNo,EngineNo,CusCode,CusDesc,BookingRefNo,BookingRefDate,BookingNo) {
        
        $("#txtChasisNo").val(ChasisNo);
        $("#txtEngineNo").val(EngineNo);
        $("#txtColor").val(ColorDesc);
        $("#hdnColorCode").val(ColorCode);
        $("#txtBrand").val(BrandDesc);
        $("#hdnBrandCode").val(BrandCode);
        $("#txtProduct").val(ProdDesc);
        $("#hdnProdCode").val(ProdCode);
        $("#txtVersion").val(Version);
        $("#txtCustomer").val(CusDesc);
        $("#hdnCusCode").val(CusCode);
        $("#txtBookingNo").val(BookingNo);
        $("#txtBookRefNo").val(BookingRefNo);
        $("#txtBookRefDate").val(BookingRefDate);

        $("#ChasisModal").modal("hide");
    }

    function validiadtor(control) {
        var input = control.val();
        if (input == "0" || input == "") {
            control.css("border-color", "red")
            control.focus();
            $("#section-confirm").modal("hide");
            $("#lblMessage").text("Please select the Required feild");
            $("#section-message").modal("show");
            return false;
        }
        else {
            control.css("border-color", "#ccc")
            return true;
        }

    }


    function AddProduct(value) {
        var check = validiadtor($("#txtChasisNo"));

        if (check == true) {
            debugger
            var brandDesc = $("#txtBrand").val();   var brandCode = $("#hdnBrandCode").val();
            var colorDesc = $("#txtColor").val();   var colorCode = $("#hdnColorCode").val();
            var prodDesc = $("#txtProduct").val();  var prodCode = $("#hdnProdCode").val();
            var cusDesc = $("#txtCustomer").val();  var cusCode = $("#hdnCusCode").val();
            var version = $("#txtVersion").val();
            var chassisNo = $("#txtChasisNo").val();
            var engineNo = $("#txtEngineNo").val();
            var bookinNo = $("#txtBookingNo").val();
            var bookRefNo = $("#txtBookRefNo").val();
            var bookRefDate = $("#txtBookRefDate").val();


            var row = $(value).parent().parent().html();
            var dt = $("#productDetail tbody").append('<tr id="fixedRow' + (rowCount++) + '" data-tr-count="' + (dataCount++) + '">' +
                                                        '<td>' + SNo++ + '</td>' +
                                                        '<td> <label id="lblBrandDesc">' + brandDesc + ' </label><input type="hidden" id="lblBrandCode" value="' + brandCode + '"/></td>' +
                                                        '<td> <label id="lblProdDesc">' + prodDesc + ' </label><input type="hidden" id="lblProdCode" value="' + prodCode + '"/></td>' +
                                                        '<td> <label id="lblVersion">' + version + ' </label></td>' +
                                                        '<td> <label id="lblColorDesc">' + colorDesc + ' </label><input type="hidden" id="lblColorCode" value="' + colorCode + '"/></td>' +
                                                        '<td> <label id="lblChassisNo">' + chassisNo + ' </label></td>' +
                                                        '<td> <label id="lblEngineNo">' + engineNo + ' </label></td>' +                                                                                                               
                                                        '<td> <label id="lblCusDesc">' + cusDesc + ' </label><input type="hidden" id="lblCusCode" value="' + cusCode + '"/></td>' +
                                                        '<td> <label id="lblBookingNo">' + bookinNo + ' </label></td>' +
                                                        '<td> <label id="lblBookRefNo">' + bookRefNo + ' </label></td>' +
                                                        '<td> <label id="lblBookRefDate">' + bookRefDate + ' </label></td>' +
                                                        '<td style="text-align:center;">' +
                                                            '<button class="btn btn-danger btn-xs" id="btnRemove" onclick="removeRow(this)"><i class="fa fa-minus fa-lg"></i></button></td>' +
                                                        '</tr>');

            clearFeilds();

        }
        else {

        }
    }

    function clearFeilds() {

        $("#txtChasisNo").val('');
        $("#txtEngineNo").val('');
        $("#txtColor").val('');
        $("#hdnColorCode").val('');
        $("#txtBrand").val('');
        $("#hdnBrandCode").val('');
        $("#txtProduct").val('');
        $("#txtVersion").val('');
        $("#hdnProdCode").val('');
        $("#txtCustomer").val('');
        $("#hdnCusCode").val('');
        $("#txtBookingNo").val('');
        $("#txtBookRefNo").val('');
        $("#txtBookRefDate").val('');

    }

    IssueFunc = function (value) {

        var lblCode = $(value).closest('tr').find("#lblCode").text();
        document.getElementById("txtDealSupp").value = lblCode;        

        $("#DealerSupplierModal").modal("hide");
    }

    $("#ddlReturnType").change(function () {
        var type = $("#ddlReturnType").val();
        if (type != "0") {
            
            getDealerSupplier(type);

        }

        $("#txtDealSupp").val('');
    });

    function getDealerSupplier(id) {

        debugger
        var leadId = id;
        var dealerCode = "@Session["DealerCode"].ToString()";

        if (leadId != "0") {
            $.ajax({
                dataType: "json",
                async: true,
                type: 'GET',
                url: '@Url.Content("~/VehicleReturn/Get_DealerSupplier")',
                data: { 'EnquiryId': leadId, 'DealerCode': dealerCode },
                success: function (data) {
                    debugger
                    if (data.Success == true) {
                        var item = JSON.parse(data.Response)
                        $("#tblDealerSupplier tbody tr").remove();
                        if (item.length > 0) {
                            $.each(item, function (value, item) {
                                $("#tblDealerSupplier tbody").append('<tr onclick="IssueFunc(this)" id="fixedRow' + (rowCount++) + '" data-tr-count="' + (dataCount++) + '">' +
                                                                '<td>' + SNo++ + '</td>' +
                                                                '<td> <label id="lblCode" >' + item.Code + ' </label></td>' +
                                                                '<td> <label >' + item.Description + ' </label></td>' +
                                                                '<td> <label >' + item.ContactPerson + ' </label></td>' +
                                                                '<td> <label >' + item.Phone + ' </label></td>' +
                                                                '</tr>');
                            })
                        }
                    }
                },
                complete: function () {},
            });
        }
    }

    $("#btnSave").click(function () {

        var check = ValidateDOMaster();
        if (check == true) {
            $("#section-confirm").modal("show");
        } else {

        }
    })

    $("#btnCancel").click(function () {

        $("#txtRetCode").val('');
        $("#txtRetDate").val(today);
        $("#txtDealSupp").val('');
        $("#ddlReturnType").val('');
        $("#txtRemarks").val('');
        $("#txtDocNo").val('');

        $("#productDetail tbody tr").remove();
    })

    $("#btnDelete").click(function () {
        $("#section-confirm-Delete").modal("show");
    })

    function DeleteEnquiry() {
        var leadId = $("#txtRetCode").val();
        var dealerCode = "@Session["DealerCode"].ToString()";

        $.ajax({
            dataType: "json",
            async: true,
            type: 'POST',
            url: '@Url.Content("~/VehicleReturn/Delete_VehicleReturn")',
            data: { 'EnquiryId': leadId, 'DealerCode': dealerCode },
            success: function (data) {
                if (data) {
                    if (data.success == true) {
                        $("#section-confirm-Delete").modal("hide")
                        $("#modalMessage").css("background-color", "#64c344");
                        $("#lblMessage").text(data.Message)
                        $("#section-message").modal('show');
                        setTimeout(function () {
                            $('#section-message').modal('hide')
                        }, 4000);
                    } else {
                        $("#section-confirm-Delete").modal("hide")
                        $("#modalMessage").css("background-color", "#e46457");
                        $("#lblMessage").text(data.Message)
                        $("#section-message").modal('show');
                        setTimeout(function () {
                            $('#section-message').modal('hide')
                        }, 4000);

                    }
                }
            },
            complete: function () {
                location.reload();
            },
        });

    }

    function ValidateDOMaster() {

        var count = 0;

        var returnType = $("#ddlReturnType").val();
        var DealSupp = $("#txtDealSupp").val();
        

        if (returnType == "0" || returnType == null) {
            $("#ddlReturnType").css("border-color", "red");
            count++;
        }

        if (DealSupp == "" || DealSupp == null) {
            $("#txtDealSupp").css("border-color", "red");
            count++;
        }       

        var rowCount = $('#productDetail >tbody  >tr').length;
        if (rowCount == 0) {
            $("#productDetail").css("border-color", "red");
        }

        if (count > 0 || rowCount == 0) {

            $("#lblMessage").html("Please fill the Required feilds");
            $("#section-message").modal("show");
            return false;
        }
        else {
            return true;
        }

    }

    function SaveEnquiry() {

        var dto = {};

        dto.DealerCode = "@Session["DealerCode"].ToString()";
        dto.ReturnCode = $("#txtRetCode").val();
        dto.ReturnDate = $("#txtRetDate").val();
        if ($("#ddlReturnType").val() == "OEM") {
            dto.VendorCode = $("#txtDealSupp").val();
        } else {            
            dto.DealerCustomer = $("#txtDealSupp").val();
        }
        dto.ReturnType = $("#ddlReturnType").val();
        dto.Remarks = $("#txtRemarks").val();
        dto.DocumentNo = $("#txtDocNo").val();
        dto.GatePass = $("#txtDocNo").val();

        $.ajax({
            dataType: "json",
            async: true,
            type: 'GET',
            url: '@Url.Content("~/VehicleReturn/Insert_VehicleReturnMaster")',
            data: dto,
            success: function (data) {
                debugger
                if (data) {
                    if (data.Success == true) {
                        saveDetailEnquiry();

                    }
                    else {
                        $("#section-confirm").modal("hide")
                        $("#modalMessage").css("background-color", "#e46457");
                        $("#lblMessage").text(data.Message)
                        $("#section-message").modal('show');
                    }
                }
            },
            complete: function () {

            },
            error: function (data) {
                $("#section-confirm").modal("hide")
                $("#modalMessage").css("background-color", "#e46457");
                $("#lblMessage").text(data.Message)
                $("#section-message").modal('show');
            }
        });
    }

    function insertRecord() {
        var obj = [];

        $("#productDetail tbody tr").each(function () {
            var dto = {};
            dto.BrandCode = $(this).closest('tr').find('#lblBrandCode').val();
            dto.ProdCode = $(this).closest('tr').find('#lblProdCode').val();
            dto.VersionCode = $(this).closest('tr').find('#lblVersion').text().trim();
            dto.ChasisNo = $(this).closest('tr').find('#lblChassisNo').text().trim();
            dto.EngineNo = $(this).closest('tr').find('#lblEngineNo').text().trim();
            dto.ColorCode = $(this).closest('tr').find('#lblColorCode').val();
            dto.BookingNo = $(this).closest('tr').find('#lblBookingNo').text().trim();
            dto.BookRefNo = $(this).closest('tr').find('#lblBookRefNo').text().trim();
            dto.BookRefDate = $(this).closest('tr').find('#lblBookRefDate').text().trim();
            dto.CusCode = $(this).closest('tr').find('#lblCusCode').val();
            dto.DealerCode = "@Session["DealerCode"].ToString()";
            obj.push(dto);
        });

        return obj;
    }

    function saveDetailEnquiry(){

        var objects = [];

        objects = JSON.stringify({ 'objects' : insertRecord()});

        $.ajax({
            contentType: 'application/json; charset=utf-8',
            dataType: "json",
            //async: true,
            type: 'POST',
            url: '@Url.Content("~/VehicleReturn/Insert_VRDetail")',
            data: objects ,
            success: function (data) {
                if (data.Success == true) {
                    $("#section-confirm").modal("hide")
                    $("#modalMessage").css("background-color", "#64c344");
                    $("#lblMessage").text(data.Message)
                    $("#section-message").modal('show');

                    location.reload();
                }
                else {
                    $("#section-confirm").modal("hide")
                    $("#modalMessage").css("background-color", "#e46457");
                    $("#lblMessage").text(data.Message)
                    $("#section-message").modal('show');
                }
            },
            complete: function () {

            },
            error: function (data) {
                $("#section-confirm").modal("hide")
                $("#modalMessage").css("background-color", "#e46457");
                $("#lblMessage").text(data.Message)
                $("#section-message").modal('show');
            }

        });

    }


    VehicleReturn = function (ReturnCode,ReturnDate,VendorCustomer,ReturnType,Remarks,DocumentNo) {

        $("#txtRetCode").val(ReturnCode);
        $("#txtRetDate").val(ReturnDate);
        $("#txtDealSupp").val(VendorCustomer);
        $("#ddlReturnType").val(ReturnType);
        $("#txtRemarks").val(Remarks);
        $("#txtDocNo").val(DocumentNo);

            if (ReturnCode != "") {
                $.ajax({
                    dataType: "json",
                    async: true,
                    type: 'GET',
                    url: '@Url.Content("~/VehicleReturn/Select_VehicleReturn")',
                    data: { 'EnquiryId': ReturnCode },
                    success: function (data) {
                        debugger;
                        if (data.Success == true) {
                            var item = JSON.parse(data.Response)

                            $("#productDetail tbody tr").remove();

                            $.each(item, function (value, item) {
                                debugger
                                $("#productDetail tbody").append('<tr id="fixedRow' + (rowCount++) + '" data-tr-count="' + (dataCount++) + '">' +
                                                        '<td>' + SNo++ + '</td>' +
                                                        '<td> <label id="lblBrandDesc">' + item.BrandDesc + ' </label><input type="hidden" id="lblBrandCode" value="' + item.BrandCode + '"/></td>' +
                                                        '<td> <label id="lblProdDesc">' + item.ProdDesc + ' </label><input type="hidden" id="lblProdCode" value="' + item.ProdCode + '"/></td>' +
                                                        '<td> <label id="lblVersion">' + item.VersionCode + ' </label></td>' +
                                                        '<td> <label id="lblColorDesc">' + item.ColorDesc + ' </label><input type="hidden" id="lblColorCode" value="' + item.ColorCode + '"/></td>' +
                                                        '<td> <label id="lblChassisNo">' + item.ChasisNo + ' </label></td>' +
                                                        '<td> <label id="lblEngineNo">' + item.EngineNo + ' </label></td>' +
                                                        '<td> <label id="lblCusDesc">' + item.CusDesc + ' </label><input type="hidden" id="lblCusCode" value="' + item.CusCode + '"/></td>' +
                                                        '<td> <label id="lblBookingNo">' + item.BookingNo + ' </label></td>' +
                                                        '<td> <label id="lblBookRefNo">' + item.BookRefNo + ' </label></td>' +
                                                        '<td> <label id="lblBookRefDate">' + item.BookRefDate + ' </label></td>' +
                                                        '<td style="text-align:center;">' +                                                         
                                                            '<button class="btn btn-danger btn-xs" id="btnRemove" onclick="removeRow(this)"><i class="fa fa-minus fa-lg"></i></button></td>' +
                                                        '</td>' +
                                                        '</tr>');

                            });

                        }
                    },
                    complete: function () {
                        $("#VehRetModal").modal("hide");
                    },
                });

            }
    }

    $("#btnPrint").click(function () {

        var baseurl = '@Url.Action("Export")';
        var url = baseurl + '?EnquiryId=' + $('#txtRetCode').val() + '&DealerCode=@Session["DealerCode"].ToString()';
        //window.location.href = url;
        window.open(url, '_blank');

    })

</script>