
@{
    ViewBag.Title = "VUMain";
    Layout = "~/Views/Shared/_LayoutV2.cshtml";
}

<style>
    .makespace {
        margin-bottom: 20px;
    }

    .icheckbox_minimal-blue {
        top: 10px;
    }
</style>

<link href="../assets/plugins/icheck/skins/all.css" rel="stylesheet" type="text/css" media="screen" />
<link href="../assets/plugins/icheck/skins/all.css" rel="stylesheet" type="text/css" media="screen" />
<script src="../assets/plugins/icheck/icheck.min.js" type="text/javascript"></script>
<link href='@Url.Content("~/assets/css/style.css")' rel="stylesheet" type="text/css" />
<link href='@Url.Content("~/assets/css/responsive.css")' rel="stylesheet" type="text/css" />



<section class="wrapper main-wrapper row" style=''>

    <div class="clearfix"></div>
    <form method="post">
        <div class="col-xs-12">
            <section class="box">
                <header class="panel_header">
                    <h2 class="title pull-left">Vehicle Update</h2>
                    <div class="actions panel_actions pull-right">
                        <a class="box_toggle fa fa-chevron-down"></a>
                        @*<a class="box_setting fa fa-cog" data-toggle="modal" href="#section-settings"></a>*@
                    </div>
                </header>
                <div class="content-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label">VIN / Chassis</label>
                            <div class="input-group">
                                <span class="input-group-addon"><a id="IssueClick" onclick="ShowModal()" style="color:blue"><i class="fa fa-search"></i></a></span>
                                <input type="text" class="form-control" id="ddlChassisNo" readonly />
                                @*@Html.DropDownList("ddlChassisNo", new SelectList((IEnumerable<SelectListItem>)ViewBag.ChassisNo, "Value", "Text", "0"), new { @class = "form-control m-bot15", @id = "ddlChassisNo" })*@
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Engine</label>
                            <div class="input-group">
                                <span class="input-group-addon"><a id="IssueClick" onclick="ShowModal()" style="color:blue"><i class="fa fa-search"></i></a></span>
                                <input type="text" class="form-control" id="ddlEngineNo" readonly />
                                @*@Html.DropDownList("ddlEngineNo", new SelectList((IEnumerable<SelectListItem>)ViewBag.EngineNo, "Value", "Text", "0"), new { @class = "form-control m-bot15", @id = "ddlEngineNo" })*@
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Customer</label>
                            <div class="input-group">
                                <span class="input-group-addon"><a><i class="fa fa-search"></i></a></span>
                                <input type="text" class="form-control" id="txtCustomers" readonly />
                                <input type="hidden" id="ddlCustomers">
                                @*@Html.DropDownList("ddlCustomers", new SelectList((IEnumerable<SelectListItem>)ViewBag.Customers, "Value", "Text", "0"), new { @class = "form-control", @id = "ddlCustomers" })*@
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Brand</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-car"></i></span>
                                <input type="text" class="form-control" id="txtBrandCode" readonly />
                            <input type="hidden" id="ddlBrandCode">
                                @*@Html.DropDownList("ddlBrandCode", new SelectList((IEnumerable<SelectListItem>)ViewBag.BrandCode, "Value", "Text", "0"), new { @class = "form-control m-bot15", @id = "ddlBrandCode" })*@</div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Product</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-car"></i></span>
                                <input type="text" class="form-control" id="txtProduct" readonly />
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Color</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-pie-chart"></i></span>
                                <input type="text" class="form-control" id="txtColor" readonly />
                                <input type="hidden" id="ddlColor">
                                @*@Html.DropDownList("ddlColor", new SelectList((IEnumerable<SelectListItem>)ViewBag.Color, "Value", "Text", "0"), new { @class = "form-control m-bot15", @id = "ddlColor" })*@
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Reg No.</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-file-text"></i></span>
                                <input type="text" class="form-control" id="txtRegNo" maxlength="15" />
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Reg Date</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input type="text" class="form-control datepicker" id="txtRegDate" readonly>
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Invoice No.</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-file"></i></span>
                                <input type="text" class="form-control" id="txtInvNo" maxlength="15" />
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Invoice Date</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input type="text" class="form-control datepicker" id="txtInvDate" readonly>
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Order No.</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-file"></i></span>
                                <input type="text" class="form-control" id="txtOrderNo" maxlength="15" />
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Order Date</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input type="text" class="form-control datepicker" id="txtOrderDate" readonly>
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Book Ref No.</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-file"></i></span>
                                <input type="text" class="form-control" id="txtBookRefNo" readonly />
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Book Ref Date</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input type="text" class="form-control datepicker" id="txtBookRefDate" readonly>
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Book Recieve Date</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input type="text" class="form-control datepicker" id="txtBookRecDate" readonly>
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Book Issue Date</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input type="text" class="form-control datepicker" id="txtBookIsuDate" readonly>
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Insurance Company</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-car"></i></span>
                                @Html.DropDownList("ddlInsurance", new SelectList((IEnumerable<SelectListItem>)ViewBag.Insurance, "Value", "Text", "0"), new { @class = "form-control m-bot15", @id = "ddlInsurance" })
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Policy No.</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-file"></i></span>
                                <input type="text" class="form-control" id="txtPolicyNo" maxlength="15" />
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Insurance Valid Date</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input type="text" class="form-control datepicker" id="txtInsDate" readonly>
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Transport Delivery</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input type="text" class="form-control datepicker" id="txtTransportDelivery" readonly>
                            </div>
                            <div class="makespace"></div>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="pull-right">
                               
                               @if (Core.CRM.ADO.SecurityBll.UserRights("2018", "003"))
                               {
                                <button type="button" class="btn btn-primary" id="btnSave" style="margin-top:25px;">Update</button>
                               }
                               else
                               {
                                <button type="button" class="btn btn-info" id="btnSave" disabled style="margin-top:27px;border-radius:0px; width:100px;display:none;">Save</button>
                               }
                                <button type="reset" class="btn btn-default" id="btnCancel" style="margin-top:25px;">Clear</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </form>

    <div class="modal" id="section-confirm" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog animated bounceInDown">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Confirm</h4>
                </div>
                <div class="modal-body">

                    <h5>Are you sure want to save ?</h5>

                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
                    <button class="btn btn-success" type="button" onclick="SaveMasterEnquiry()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="section-message" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog animated bounceInDown">
            <div class="modal-content">
                <div class="modal-header" id="modalMessage">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Success</h4>
                </div>
                <div class="modal-body">

                    <h5 id="lblMessage"></h5>

                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default" type="button" onclick="location.reload();">Close</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Chassis / Engine No Modal Start -->
    <div class="modal" tabindex="-1" id="DOModal" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="margin-top:60px;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="modal123Label">Chassis No / Engine No</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group row">
                        <label for="exampleInputuname" class="col-md-2">Search :</label>
                        <div class="col-md-10">
                            <input type="text" id="DOSearch" class="form-control" aria-controls="tblCE" placeholder="Search . . . ">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="table-responsive">
                            <table id="tblCE" class="table table-striped table-hover responsive">
                                <thead>
                                    <tr>
                                        <th>S. No</th>
                                        <th>Chassis No</th>
                                        <th>Engine No</th>                                        
                                    </tr>
                                </thead>
                                <tbody style="font-size:12px; text-transform: uppercase">
                                    @{ int i = 1; }
                                     @if (ViewBag.EngineNo != null)
                                    {

                                        foreach (var item in ViewBag.EngineNo)
                                        {
                                            <tr style="text-align:left" onclick="IssueFunc(this)">
                                                <td> @i</td> @{ i++; }
                                                <td>
                                                    <label id="lblChasisNo">@item.ChasisNo</label>
                                                </td>

                                                <td style="text-align:center;">
                                                    <label id="lblEngineNo">@item.EngineNo</label>
                                                </td>

                                            </tr>

                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>                
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!--Chassis / Engine No Modal End -->
</section>



    @*<link href='@Url.Content("~/assets/plugins/datepicker/css/datepicker.css")' rel="stylesheet" type="text/css" media="screen" />*@
    <link href='@Url.Content("~/assets/plugins/select2/select2.css")' rel="stylesheet" type="text/css" media="screen" />
    <link href='@Url.Content("~/assets/plugins/icheck/skins/minimal/blue.css")' rel="stylesheet" type="text/css" media="screen" />
    <script src='@Url.Content("~/assets/js/jquery-1.11.2.min.js")' type="text/javascript"></script>
    <script src='@Url.Content("~/assets/plugins/select2/select2.min.js")' type="text/javascript"></script>
    <script src='@Url.Content("~/assets/plugins/icheck/icheck.min.js")' type="text/javascript"></script>


<script>
    $(document).ready(function () {
        $("#DOSearch").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#tblCE tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });
    $(document).ready(function () {
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth() + 1; //January is 0!
        var yyyy = today.getFullYear();

        if (dd < 10) {
            dd = '0' + dd
        }

        if (mm < 10) {
            mm = '0' + mm
        }

        //today = mm + '/' + dd + '/' + yyyy;
        today = dd + '-' + mm + '-' + yyyy;

        $("#txtRegDate").val(today);
        $("#txtInvDate").val(today);
        $("#txtOrderDate").val(today);
        $("#txtBookRefDate").val(today);
        $("#txtBookRecDate").val(today);
        $("#txtBookIsuDate").val(today);
        $("#txtInsDate").val(today);
        $("#txtTransportDelivery").val(today);
    })


    function ShowModal(type) {

        $('#DOModal').modal("show");

    }

    IssueFunc = function (value) {

        debugger
        //var lblBrandCode = $(value).closest('tr').find("#hdnCusCode").val();
        var chassisNo = $(value).closest('tr').find('#lblChasisNo').text();

        getVehicleDetail(chassisNo, 'C');

        $("#DOModal").modal("hide");
    }

    $("#ddlChassisNo").change(function () {

        var chassisNo = $("#ddlChassisNo").val();
        var selected = 'C';

        if (chassisNo == "0") {
            location.reload();
        } else {
            getVehicleDetail(chassisNo, selected);
        }
    });

    $("#ddlEngineNo").change(function () {

        var chassisNo = $("#ddlEngineNo").val();
        var selected = 'E';

        if (chassisNo == "0") {
            location.reload();
        } else {
            getVehicleDetail(chassisNo, selected);
        }
    });

    function getVehicleDetail(chassisNo, selected) {

        var leadId = chassisNo;

        if (leadId != "0") {
            $.ajax({
                dataType: "json",
                async: true,
                type: 'GET',
                url: '@Url.Content("~/VehicleUpdate/Select_VehicleDetail")',
                data: { 'EnquiryId': leadId },
                success: function (data) {

                    if (data.Success == true) {
                        var item = JSON.parse(data.Response)
                        debugger
                        //Event Information
                        
                            $("#ddlChassisNo").val(item[0].ChasisNo);
                        
                            $("#ddlEngineNo").val(item[0].EngineNo);
                                          
                        debugger
                        $("#ddlColor").val(item[0].ColorCode);
                        $("#txtColor").val(item[0].ColorDesc);
                        $("#ddlBrandCode").val(item[0].BrandCode);
                        $("#txtBrandCode").val(item[0].BrandDesc);
                        $("#txtProduct").val(item[0].ProdCode);
                        $("#ddlCustomers").val(item[0].CusCode);
                        $("#txtCustomers").val(item[0].CusDesc);
                        $("#txtRegNo").val(item[0].RegNo);
                        $("#txtRegDate").val(item[0].RegDate);                       
                        $("#txtInvNo").val(item[0].InvoiceNo);
                        $("#txtInvDate").val(item[0].InvoiceDate);
                        $("#txtOrderNo").val(item[0].OrderNo);
                        $("#txtOrderDate").val(item[0].OrderDate);
                        $("#txtBookRefNo").val(item[0].BookingRefNo);
                        $("#txtBookRefDate").val(item[0].BookingRefDate);
                        $("#txtBookRecDate").val(item[0].BookRecDate);
                        $("#txtBookIsuDate").val(item[0].BookIssueDate);
                        $("#ddlInsurance").val(item[0].InsCompCode);
                        $("#txtPolicyNo").val(item[0].InsPolicyNo); 
                        $("#txtInsDate").val(item[0].InsDate);
                        $("#txtTransportDelivery").val(item[0].TransportDelivery);

                    }
                },
                complete: function () {

                },
            });

        }
    }

    $("#btnSave").click(function () {
        debugger
        //var check = ValidateBOMaster();
        check = true;
        if (check == true) {
            $("#section-confirm").modal("show");
        }
    })

    function ValidateBOMaster() {
        var check = false;
        check = Validate("#ddlCusType");
        check = Validate("#ddlCusTaxType");
        check = Validate("#ddlSegment");
        check = Validate("#ddlStkType");
        check = Validate("#ddlInvType");
        check = Validate("#ddlInvSubType");
        check = Validate("#ddlPriceType");
        check = Validate("#ddlpayment");
        check = Validate("#ddlCustomers");
        check = Validate("#ddlACof");

        return check;
    }

    function Validate(item) {
        var val = $(item).val();
        if (val == "0") {
            $(item).css("border-color", "red");
            $('html, body').animate({
                scrollTop: $(item).scrollTop(500)
            }, 800);
            return false;
        }
        else {
            $(item).css("border-color", "#ccc");
            return true;
        }
    }

    function SaveMasterEnquiry() {

        var dto = {};


        dto.DealerCode = "@Session["DealerCode"].ToString()";
        dto.ChasisNo = $("#ddlChassisNo").val();
        dto.EngineNo = $("#ddlEngineNo").val();
        dto.CusCode = $("#ddlCustomers").val();
        dto.BrandCode = $("#ddlBrandCode").val();
        dto.ProdCode = $("#txtProduct").val();
        dto.ColorCode = $("#ddlColor").val();
        dto.RegNo = $("#txtRegNo").val();
        dto.RegDate = $("#txtRegDate").val();
        dto.InvoiceNo = $("#txtInvNo").val();
        dto.InvoiceDate = $("#txtInvDate").val();
        dto.OrderNo = $("#txtOrderNo").val();
        dto.OrderDate = $("#txtOrderDate").val();
        dto.BookingRefNo = $("#txtBookRefNo").val();
        dto.BookingRefDate = $("#txtBookRefDate").val();
        dto.BookRecDate = $("#txtBookRecDate").val();
        dto.BookIssueDate = $("#txtBookIsuDate").val();
        dto.InsCompCode = $("#ddlInsurance").val();
        dto.InsPolicyNo = $("#txtPolicyNo").val(); ;
        dto.InsDate = $("#txtInsDate").val();
        dto.TransportDelivery = $("#txtTransportDelivery").val();
      

        $.ajax({
            dataType: "json",
            async: true,
            type: 'GET',
            url: '@Url.Content("~/VehicleUpdate/Insert_VSMaster")',
            data: dto,
            success: function (data) {
                debugger
                if (data) {
                    if (data.Success == true) {
                        $("#section-confirm").modal("hide")
                        $("#modalMessage").css("background-color", "#64c344");
                        $("#lblMessage").text(data.Message)
                        $("#section-message").modal('show');
                        clearFeilds();
                        location.reload();
                        
                    }
                    else {
                        $("#section-confirm").modal("hide")
                        $("#modalMessage").css("background-color", "#e46457");
                        $("#lblMessage").text(data.Message)
                        $("#section-message").modal('show');
                    }
                }
            },
            complete: function () {

            },
            error: function (data) {
                $("#section-confirm").modal("hide")
                $("#modalMessage").css("background-color", "#e46457");
                $("#lblMessage").text(data.Message)
                $("#section-message").modal('show');
            }
        });
    }

    function clearFeilds(){

        $("#ddlBrandCode").val("0");
        $("#ddlColor").val("0");
        $("#txtProduct").val("");
        $("#ddlChassisNo").val("0");
        $("#ddlCustomers").val("0");
        $("#ddlEngineNo").val("0");
        $("#txtRegNo").val("");
        $("#txtRegDate").val("");
        $("#txtInvNo").val("");
        $("#txtInvDate").val("");
        $("#txtOrderNo").val("");
        $("#txtOrderDate").val("");
        $("#txtBookRefNo").val("");
        $("#txtBookRefDate").val("");
        $("#txtBookRecDate").val("");
        $("#txtBookIsuDate").val("");
        $("#ddlInsurance").val("0");
        $("#txtPolicyNo").val("");
        $("#txtInsDate").val("");
    }

</script>
