
@{
    ViewBag.Title = "SaleTarget";
    Layout = "~/Views/Shared/_LayoutV2.cshtml";
}

<h2>Sale Target</h2>

<link rel="shortcut icon" href='@Url.Content("~/assets/images/Favicon365.png")' type="image/x-icon" />    <!-- Favicon -->
<link rel="apple-touch-icon-precomposed" href="../assets/images/apple-touch-icon-57-precomposed.png">	<!-- For iPhone -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/images/apple-touch-icon-114-precomposed.png">    <!-- For iPhone 4 Retina display -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/images/apple-touch-icon-72-precomposed.png">    <!-- For iPad -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/images/apple-touch-icon-144-precomposed.png">    <!-- For iPad Retina display -->

<!-- HEADER SCRIPTS INCLUDED ON THIS PAGE - START -->


<link href='@Url.Content("~/assets/plugins/morris-chart/css/morris.css")' rel="stylesheet" type="text/css" media="screen" />
<link href='@Url.Content("~/assets/plugins/jquery-ui/smoothness/jquery-ui.min.css")' rel="stylesheet" type="text/css" media="screen" />
<link href="~/assets/plugins/icheck/skins/futurico/futurico.css" rel="stylesheet" />
<link href='@Url.Content("~/assets/plugins/jvectormap/jquery-jvectormap-2.0.1.css")' rel="stylesheet" type="text/css" media="screen" />
<link href='@Url.Content("~/assets/plugins/icheck/skins/minimal/white.css")' rel="stylesheet" type="text/css" media="screen" />
<link href='@Url.Content("~/assets/plugins/timepicker/css/bootstrap-timepicker.min.css")' rel="stylesheet" />
<link href='@Url.Content("~/assets/plugins/datepicker/css/datepicker.css")' rel="stylesheet" />
<!-- HEADER SCRIPTS INCLUDED ON THIS PAGE - END -->
<!-- CORE CSS TEMPLATE - START -->
<link href='@Url.Content("~/assets/css/style.css")' rel="stylesheet" type="text/css" />
<link href='@Url.Content("~/assets/css/responsive.css")' rel="stylesheet" type="text/css" />


<style type='text/css'>
     .makespace {
        margin-bottom: 20px;
    }
    /* Style to hide Dates / Months */
    .ui-datepicker-calendar, .ui-datepicker-month {
        display: none;
    }
</style>
<!-- HEADER SCRIPTS INCLUDED ON THIS PAGE - END -->
<!-- CORE CSS TEMPLATE - START -->
<link href="../assets/css/style.css" rel="stylesheet" type="text/css" />
<link href="../assets/css/responsive.css" rel="stylesheet" type="text/css" />
<!-- CORE CSS TEMPLATE - END -->
<section class="wrapper main-wrapper row" style=''>

    <div class="clearfix"></div>
    <form method="post">
        <div class="col-xs-12">
            <section class="box">
                <header class="panel_header">
                    <h2 class="title pull-left">Sales Target </h2>
                    <div class="actions panel_actions pull-right">
                        <a class="box_toggle fa fa-chevron-down"></a>
                        @*<a class="box_setting fa fa-cog" data-toggle="modal" href="#section-settings"></a>*@
                    </div>
                </header>
                <div class="content-body">
                    <div class="row">
                      
                        <div class="col-md-4">
                            <label class="form-label">Month/Year <span class="mandatory" style="color:red;">*</span></label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input type="month" class="form-control " id="txtMonthYear"  >
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Brand<span class="mandatory" style="color:red;">*</span></label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-car"></i></span>
                                @Html.DropDownList("ddlBrandCode", new SelectList((IEnumerable<SelectListItem>)ViewBag.BrandCode, "Value", "Text", "0"), new { @class = "form-control m-bot15", @id = "ddlBrandCode", @onchange = "ChangeColor(this)" })
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Product Code<span class="mandatory" style="color:red;">*</span></label>
                            <div class="input-group">
                                <span class="input-group-addon"><a id="IssueClick" onclick="ShowModal('Product')" style="color:blue;cursor:pointer"><i class="fa fa-search"></i></a></span>
                                @*@Html.DropDownList("ddlProdCode", new SelectList((IEnumerable<SelectListItem>)ViewBag.ProdCode, "Value", "Text", "0"), new { @class = "form-control m-bot15", @id = "ddlProdCode", @onchange = "ChangeColor(this)" })*@
                                <input type="text" class="form-control" id="ddlProdCode" readonly />
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Product</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-car"></i></span>
                                <input type="text" readonly="readonly" class="form-control" id="txtProdDesc" />
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Version</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-car"></i></span>
                               
                                <input type="text" class="form-control" id="txtVersionCode"  style="width:25%"/>
                                <input type="text" class="form-control" id="txtVersionDesc" style="width:70%" />
                            </div>
                            <div class="makespace"></div>
                        </div>
                       
                       
                      

                        <div class="col-md-4">
                            <label class="form-label">Invoice</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input type="text" class="form-control " id="txtInvQty">
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Booking</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input type="text" class="form-control " id="txtBookQty" >
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Allocation</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input type="text" class="form-control " id="txtAllocationQty" >
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-striped" id="tblSaleTarget" style="white-space: nowrap; FONT-SIZE: 10px;">
                                        <thead>
                                            <tr>
                                                <th>SR</th>
                                                <th>Brand</th>
                                                <th>Product</th>
                                                <th>Version</th>
                                                <th>Year</th>
                                                <th>Month</th>
                                                <th>Invoice</th>
                                                <th>Booking</th>
                                                <th>Allocation</th>
                                                
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr id="fixRow"></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="pull-right">
                                <a class="btn btn-primary" id="btnSave" href="#">Save</a>
                                <button type="reset" class="btn btn-default">Clear</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </form>
    
    <!-- Product Modal Start -->
    <div class="modal" tabindex="-1" id="ProductModal" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="margin-top:60px;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="modal123Label">Product</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group row">
                        <label for="exampleInputuname" class="col-md-2">Search :</label>
                        <div class="col-md-10">
                            <input type="text" id="ProductSearch" class="form-control" aria-controls="ProductTable" placeholder="Search . . . ">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="table-responsive" style="height:350px;">
                            <table id="ProductTable" class="table table-striped table-hover responsive">
                                <thead>
                                    <tr>
                                        <th>Sr</th>
                                        <th>Product Code</th>
                                        <th>Product Description</th>
                                        <th>Version</th>
                                    </tr>
                                </thead>
                                <tbody style="font-size:12px; text-transform: uppercase"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- Product Modal End -->
    <!-- Popup box modal start -->
    <div class="modal" id="section-confirm" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog animated bounceInDown">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Confirm</h4>
                </div>
                <div class="modal-body">

                    <h5>Are you sure want to save ?</h5>

                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
                    <button class="btn btn-success" type="button" onclick="SaveMasterEnquiry()">Save</button>
                </div>
            </div>
        </div>
    </div>
    <!-- modal end -->
    <div class="modal" id="section-confirm-Delete" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog animated bounceInDown">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Confirm</h4>
                </div>
                <div class="modal-body">

                    <h5>Are you sure want to Delete ?</h5>

                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
                    <button class="btn btn-danger" type="button" onclick="DeleteEnquiry()">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Popup box modal start -->
    <div class="modal" id="section-message" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog animated bounceInDown">
            <div class="modal-content">
                <div class="modal-header" id="modalMessage">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Alert</h4>
                </div>
                <div class="modal-body">

                    <h5 id="lblMessage"></h5>

                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- modal end -->
</section>

<link href='@Url.Content("~/assets/plugins/select2/select2.css")' rel="stylesheet" type="text/css" media="screen" />
<link href='@Url.Content("~/assets/plugins/icheck/skins/minimal/blue.css")' rel="stylesheet" type="text/css" media="screen" />
<script src='@Url.Content("~/assets/js/jquery-1.11.2.min.js")' type="text/javascript"></script>
<script src='@Url.Content("~/assets/plugins/bootstrap/js/bootstrap.min.js")'></script>
<script src='@Url.Content("~/assets/plugins/datepicker/js/datepicker.js")'></script>

@* Select Before Save  *@
<script>
  
    function ChangeColor(value) {

        if ($(value).val() != '')
            $(value).css("border-color", "#e1e1e1");
    }
  
    function ShowModal(type) {

     if (type == 'Product') {
        $('#ProductModal').modal("show");
    }
    }
    $("#ddlBrandCode").change(function () {

        var brandCode = $("#ddlBrandCode").val();
        if (brandCode == "0") {
            location.reload();
        } else {
           
            getProduct(brandCode);

        }
    });
    function getProduct(id) {

    
        var rowCount = 1;
        var dataCount = 1;
        var SNo = 1;
        var leadId = id;

        var dealerCode = "@Session["DealerCode"].ToString()";
        if (leadId != "0") {
            $.ajax({
                dataType: "json",
                async: true,
                type: 'GET',
                url: '@Url.Content("~/VehicleReceipt/Select_BrandProduct")',
                data: { 'EnquiryId': leadId, 'DealerCode': dealerCode },
                success: function (data) {

                    if (data.Success == true) {
                        //var item = JSON.parse(data.Response)

                        ////$("#ddlProdCode").val(item[0].ProdCode.trim());
                        //$("#ddlProdCode").find('option').remove();

                        //// next iterate thru your object adding each option to the drop down\
                        //$(data.Response).each(function (index, item) { // GETTING ERROR HERE
                        //    $("#ddlProdCode").append($('<option value=' + item.Value + ' >' + item.Text + '</option>'));
                        //});
                       
                        $("#ProductTable tbody tr").remove()
                        if (data.Response.length > 0) {
                         
                            $.each(data.Response, function (value, data) {

                                var temp = '<tr id="DelChkListRow1' + (rowCount++) + '" data-tr-count="' + (dataCount++) + '" onclick="ProductSelect(this)">' +
                                    '<td>' + SNo++ + '</td>' +
                              '<td class="tdDiv" style="overflow:auto"><label id="lblProdCode">' + data.ProdCode + '</label><input type="hidden" id="hdnProdCode" value="' + data.ProdCode + '"/></td>' +
                               '<td class="tdDiv" style="overflow:auto"><label id="lblProdDesc">' + data.ProdDesc + '</label></td>' +
                              '<td class="tdDiv" style="overflow:auto"><label id="lblVersionCode">' + data.VersionDesc + '</label><input type="hidden" id="hdnVersionDesc" value="' + data.VersionCode + '"/></td>' +
                             
                                '</tr>';

                                $("#ProductTable tbody").append(temp);


                            });

                        }

                    }
                },
                complete: function () {
                    if (tempProduct != "") {
                        $("#ddlProdCode").val(tempProduct);

                    }

                },
            });

        }

    }
    ProductSelect = function (value) {
        var prodCode = $(value).closest('tr').find("#hdnProdCode").val();
        var prodDesc = $(value).closest('tr').find('#lblProdDesc').text();
        var version = $(value).closest('tr').find('#lblVersionCode').text();
        var versionDesc = $(value).closest('tr').find("#hdnVersionDesc").val();

        document.getElementById("ddlProdCode").value = prodCode;
        $("#ddlProdCode").css("border-color", "#e1e1e1");
        document.getElementById("txtProdDesc").value = prodDesc;
        document.getElementById("txtVersionDesc").value = version;
        document.getElementById("txtVersionCode").value = versionDesc;

        $("#ProductModal").modal("hide");
    }

   



</script>

@* Save Scricpt *@
<script>
    $("#btnSave").click(function () {
    debugger
        if (!PageValidation()) {
            return false;
        }

        //var check = ValidateBOMaster();
        //if (check == true) {
        $("#section-confirm").modal("show");
        //}
    })

    function PageValidation() {


        var count = 0;
        
        if ($("#txtMonthYear").val() == '' || $("#txtMonthYear").val() == null) {
            $("#txtMonthYear").css("border-color", "red");
            $("#txtMonthYear").focus();
            count++;
        }
        if ($("#ddlBrandCode").val() == '0' || $("#ddlBrandCode").val() == null) {
            $("#ddlBrandCode").css("border-color", "red");
            $("#ddlBrandCode").focus();
            count++;
        }
        if ($("#ddlProdCode").val() == '' || $("#ddlProdCode").val() == null) {
            $("#ddlProdCode").css("border-color", "red");
            $("#ddlProdCode").focus();
            count++;
        }
     
     debugger
        var MonthYear = $("#txtMonthYear").val();
        var splitLoc = MonthYear.split('-', MonthYear.length);
        var Year = splitLoc[0];
        var Month = splitLoc[1];
        

        //$("#tblSaleTarget tbody tr").each(function () {
        //    debugger;
        //    if(Month==parseFloat($(this).closest('tr').find('td:eq(5)').text())){

        //    }

        //});

        
        if (count > 0) {

            $("#lblMessage").html("Please fill the Required feilds");
            $("#section-message").modal("show");
            return false;
        }

        else {
            return true;
        }

    }

    function SaveMasterEnquiry() {

        var dto = {};
        var MonthYear = $("#txtMonthYear").val();
        var splitLoc = MonthYear.split('-', MonthYear.length);
        var Year = splitLoc[0];
        var Month = splitLoc[1];

        dto.DealerCode = "@Session["DealerCode"].ToString()";
        dto.TargetYear = Year;
        dto.TargetMonth = Month;
        dto.BrandCode = $("#ddlBrandCode").val();
        dto.ProdCode = $("#ddlProdCode").val();
        dto.VersionCode = $("#txtVersionCode").val();
        dto.InvoiceTargetQty = $("#txtInvQty").val();
        dto.BookingTargetQty = $("#txtBookQty").val();
        dto.AllocationTargetQty = $("#txtAllocationQty").val();
     

        $.ajax({
            dataType: "json",
            async: true,
            type: 'POST',
            url: '@Url.Content("~/SaleTarget/Insert_SaleTarget")',
            data: dto,
            success: function (data) {

                if (data) {
                    if (data.Success == true) {
                       
                        $("#section-confirm").modal("hide")
                        $("#modalMessage").css("background-color", "#64c344");
                        $("#lblMessage").text(data.Message)
                        $("#section-message").modal('show');
                    }
                    else {
                        $("#section-confirm").modal("hide")
                        $("#modalMessage").css("background-color", "#e46457");
                        $("#lblMessage").text(data.Message)
                        $("#section-message").modal('show');
                    }
                }
            },
            complete: function () {
                location.reload();
            },
            error: function (data) {
                $("#section-confirm").modal("hide")
                $("#modalMessage").css("background-color", "#e46457");
                $("#lblMessage").text(data.Message)
                $("#section-message").modal('show');
            }
          
        });
    }
</script>

@* gET data *@
<script>
    $(document).ready(function () {
        var dealer = '@Session["DealerCode"].ToString()';
        Get_TargetSale(dealer);

      
    });
    function Get_TargetSale(value) {
        var rowCount = 1;
        var dataCount = 1;
        var SNo = 1;
        $.ajax({
            dataType: "json",
            async: true,
            type: 'GET',
            data: { 'dealer': value },
            //Select_BrandDetails
            url: '@Url.Content("~/SaleTarget/Select_SaleTarget")',
            success: function (data) {

                if (data.Success == true) {

                    var item = JSON.parse(data.Response)
                    $("#tblSaleTarget tbody tr").remove()

                    if (item.length > 0) {

                        $.each(item, function (value, item) {
                        
                        $("#tblSaleTarget tbody").append('<tr onclick="Get_InsComp(this);" id="fixRow' + (rowCount++) + '" data-tr-count="' + (dataCount++) + '">' +
                                           '<td>' + SNo++ + '</td>' +
                                           '<td id="lblBrandDesc"><label>' + item.BrandDesc + '<input type="hidden" id="hdnBrandCode" value="' + item.BrandCode + '"></td>' +
                                            '<td id="lblProdDesc">' + item.ProdDesc + '<input type="hidden" id="hdnProdCode" value="' + item.ProdCode + '"></td>' +
                                            '<td id="lblVersionDesc">' + item.VersionDesc + '<input type="hidden" id="hdnVersionCode" value="' + item.VersionCode + '"></td>' +
                                             '<td id="year">' + item.TargetYear + '</td>' +
                                              '<td id="month">' + item.TargetMonth + '</td>' +
                                               '<td id="invqty">' + item.InvoiceTargetQty + '</td>' +
                                                '<td id="bookqty">' + item.BookingTargetQty + '</td>' +
                                                 '<td id="alloqty">' + item.AllocationTargetQty + '</td>' +
                                          


                                               '</tr>');
                        });

                    }
                }
            },
            complete: function () {

            },
        });
    }


    
    function Get_InsComp(value) {
    debugger
    var brandCode = $(value).closest('tr').find("#hdnBrandCode").val();
        var brandDesc = $(value).closest('tr').find("#lblBrandDesc").text();
        var ProdCode = $(value).closest('tr').find("#hdnProdCode").val();
        var ProdDesc = $(value).closest('tr').find("#lblProdDesc").text();
        var VersionCode = $(value).closest('tr').find("#hdnVersionCode").val();
        var VersionDesc = $(value).closest('tr').find("#lblVersionDesc").text();
        var Year = $(value).closest('tr').find("#year").text();
        var Month = $(value).closest('tr').find("#month").text();
        var InvQty = $(value).closest('tr').find("#invqty").text();
        var BookQty = $(value).closest('tr').find("#bookqty").text();
        var AllocationQty = $(value).closest('tr').find("#alloqty").text();
        var MonthYear = Year+'-'+Month;
      




        $("#txtMonthYear").val(MonthYear);
        $("#ddlBrandCode").val(brandCode);
        $("#ddlProdCode").val(ProdCode);
        $("#txtProdDesc").val(ProdDesc);
        $("#txtVersionCode").val(VersionCode);
        $("#txtVersionDesc").val(VersionDesc);
        $("#txtInvQty").val(InvQty);
        $("#txtBookQty").val(BookQty);
        $("#txtAllocationQty").val(AllocationQty);
      

     
    }
</script>





